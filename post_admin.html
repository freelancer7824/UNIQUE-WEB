<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel â€“ Manage Posts & Projects</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#f5f7fa;padding:30px;color:#333;}
h1{text-align:center;color:#0d47a1;margin-bottom:30px;}
.form-box{max-width:600px;margin:0 auto;background:#fff;padding:25px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.form-group{margin-bottom:15px;}
label{display:block;margin-bottom:6px;font-weight:600;color:#0d47a1;}
input,textarea,select{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;font-size:15px;}
textarea{resize:vertical;min-height:100px;}
button{background:#0d47a1;color:#fff;border:none;padding:12px 20px;border-radius:8px;cursor:pointer;font-weight:600;margin-top:5px;width:100%;}
button:hover{background:#1976d2;}
.success-msg,.error-msg{text-align:center;margin-top:15px;font-weight:600;}
.success-msg{color:green;}
.error-msg{color:red;}
.preview{margin-top:8px;max-width:100px;border-radius:8px;}
</style>
</head>
<body>

<h1>Admin Panel</h1>
<div class="form-box">

  <div class="form-group">
    <label for="category">Select Category</label>
    <select id="category">
      <option value="posts">Posts</option>
      <option value="projects">Projects</option>
    </select>
  </div>

  <div class="form-group">
    <label for="author">Author Name</label>
    <input type="text" id="author" value="SHOPON HASAN PRIYO">
  </div>

  <div class="form-group">
    <label>Author Photo</label>
    <input type="file" id="authorUpload" accept="image/*">
    <input type="hidden" id="authorPhoto" value="https://i.ibb.co/2g9zZ5R/default.png">
    <img id="authorPreview" src="https://i.ibb.co/2g9zZ5R/default.png" class="preview">
  </div>

  <div class="form-group">
    <label>Post Image</label>
    <input type="file" id="imageUpload" accept="image/*">
    <input type="hidden" id="image">
    <img id="imagePreview" class="preview" style="display:none;">
  </div>

  <div class="form-group">
    <label for="title">Post Title</label>
    <input type="text" id="title" placeholder="Enter title (optional)">
  </div>

  <div class="form-group">
    <label for="content">Content</label>
    <textarea id="content" placeholder="Write something (optional)"></textarea>
  </div>

  <button id="submitBtn">Publish</button>
  <div class="success-msg" id="successMsg"></div>
  <div class="error-msg" id="errorMsg"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAqhLfmOfmP-_8DOcoEH7Ck7fMF9Id4vJ4",
  authDomain: "earn-project-5f892.firebaseapp.com",
  databaseURL: "https://earn-project-5f892-default-rtdb.firebaseio.com/",
  projectId: "earn-project-5f892",
  storageBucket: "earn-project-5f892.firebasestorage.app",
  messagingSenderId: "8457886057",
  appId: "1:8457886057:web:b5e01d0972d169f47085f8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const cloudName = "dhvtgzy5x"; // CHANGE TO YOUR CLOUDINARY CLOUD NAME
const uploadPreset = "Rosenews"; // CHANGE TO YOUR UPLOAD PRESET

// Restore saved author image from localStorage
const savedAuthorPhoto = localStorage.getItem("authorPhoto");
if (savedAuthorPhoto) {
  document.getElementById("authorPhoto").value = savedAuthorPhoto;
  document.getElementById("authorPreview").src = savedAuthorPhoto;
}

// Upload function
async function autoUpload(fileInputId, targetId, previewId, saveToLocal=false){
  const fileInput = document.getElementById(fileInputId);
  fileInput.addEventListener("change", async ()=>{
    const file = fileInput.files[0];
    if(!file) return;
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", uploadPreset);
    const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`,{
      method:"POST",
      body: formData
    });
    const data = await res.json();
    if(data.secure_url){
      document.getElementById(targetId).value = data.secure_url;
      const preview = document.getElementById(previewId);
      preview.src = data.secure_url;
      preview.style.display = "block";

      // Save author photo permanently
      if(saveToLocal){
        localStorage.setItem("authorPhoto", data.secure_url);
      }
    }
  });
}

// Auto upload (author saves permanently, post image temporary)
autoUpload("authorUpload","authorPhoto","authorPreview",true);
autoUpload("imageUpload","image","imagePreview",false);

// Save post to Firebase
document.getElementById("submitBtn").addEventListener("click",()=>{
  const category = document.getElementById("category").value;
  const author = document.getElementById("author").value.trim() || "SHOPON HASAN PRIYO";
  const authorPhoto = document.getElementById("authorPhoto").value;
  const title = document.getElementById("title").value.trim() || "(No Title)";
  const image = document.getElementById("image").value || "https://via.placeholder.com/600x400?text=No+Image";
  const content = document.getElementById("content").value.trim() || "(No Content)";

  const postData = {
    author,
    authorPhoto,
    title,
    image,
    content,
    date: new Date().toLocaleString(),
    likes: 0,
    comments: []
  };

  const newPostKey = push(ref(db, category)).key;
  set(ref(db,`${category}/${newPostKey}`),postData)
    .then(()=>{
      document.getElementById("successMsg").textContent="Post published successfully!";
      document.getElementById("errorMsg").textContent="";
    })
    .catch(err=>{
      document.getElementById("errorMsg").textContent="Error: "+err.message;
      document.getElementById("successMsg").textContent="";
    });
});
</script>
</body>
</html>