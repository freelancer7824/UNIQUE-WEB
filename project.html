<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Projects – Firebase + Cloudinary</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* Same style as posts page */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif; background:#f5f7fa; color:#333; padding:40px 20px;}
.page-header{text-align:center; margin-bottom:40px;}
.page-header h1{font-size:36px; font-weight:600; color:#0d47a1;}
.page-header p{color:#555; font-size:18px; margin-top:10px;}
.posts{max-width:1200px; margin:0 auto; display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:30px;}
.post-card{background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); overflow:hidden; display:flex; flex-direction:column; transition:transform 0.3s ease, box-shadow 0.3s ease;}
.post-card:hover{transform:translateY(-6px); box-shadow:0 8px 20px rgba(0,0,0,0.15);}
.post-header {display:flex; align-items:center; padding:15px 20px; background:#fafafa; border-bottom:1px solid #eee; gap:10px;}
.post-header img{width:50px; height:50px; border-radius:50%; object-fit:cover; flex-shrink:0; margin-right:12px; border:2px solid #0d47a1;}
.post-header .author-name{font-weight:600; font-size:16px; color:#0d47a1;}
.post-header .post-date{font-size:13px; color:#555; margin-left:6px;}
.post-image{width:100%; overflow:hidden; position:relative; aspect-ratio:9/9; cursor: pointer;}
.post-image img{width:100%; height:100%; object-fit:cover; display:block; transition:transform 0.5s ease;}
.post-card:hover .post-image img{transform:scale(1.05);}
.post-content{padding:20px; flex-grow:1;}
.post-content h2{font-size:20px; color:#0d47a1; margin-bottom:10px;}
.post-content p{color:#555; font-size:15px; line-height:1.5;}
.post-content .text-container {position: relative;overflow: hidden;max-height: 3em;transition: max-height 0.3s ease;}
.post-content .text-container.expanded {max-height: none;}
.read-more-btn {color: #0d47a1;cursor: pointer;font-weight: 600;margin-top: 5px;display: inline-block;}
.read-more-btn:hover {text-decoration: underline;}
.post-actions{display:flex; justify-content:space-around; align-items:center; border-top:1px solid #eee; padding:12px 0; background:#fafafa;}
.action-btn{display:flex; align-items:center; gap:6px; cursor:pointer; color:#0d47a1; font-weight:500; transition:color 0.3s ease;}
.action-btn i{font-size:16px;}
.action-btn:hover{color:#1976d2;}
.comment-section{display:none; flex-direction:column; padding:0 20px 20px 20px; border-top:1px solid #eee;}
.comment-section input{padding:8px; margin-bottom:10px; border-radius:6px; border:1px solid #ccc; width:100%;}
.send-comment-btn{background:#0d47a1; color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; transition:background 0.3s;}
.send-comment-btn:hover{background:#1976d2;}
.comment-list{max-height:150px; overflow-y:auto; margin-top:10px;}
.comment-item{padding:6px 0; border-bottom:1px solid #eee; font-size:14px; color:#333;}
.like-count{font-size:14px;}

/* Image Modal */
.image-modal {display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.9);justify-content:center;align-items:center;}
.modal-content {max-width:90%;max-height:90%;object-fit:contain;}
.close-modal {position:absolute;top:15px;right:35px;color:#f1f1f1;font-size:40px;font-weight:bold;cursor:pointer;}
.nav-btn {position:absolute;top:50%;transform:translateY(-50%);color:white;font-size:30px;cursor:pointer;background:rgba(0,0,0,0.5);padding:15px;border-radius:50%;user-select:none;}
.prev-btn {left:15px;}
.next-btn {right:15px;}
.nav-btn:hover {background:rgba(0,0,0,0.8);}
@media(max-width:600px){
  .page-header h1{font-size:28px;}
  .page-header p{font-size:16px;}
  .post-content h2{font-size:18px;}
  .post-content p{font-size:14px;}
  .post-header .author-name{font-size:14px;}
  .nav-btn {font-size:20px;padding:10px;}
}
</style>
</head>
<body>

<header class="page-header">
  <h1>Our Projects</h1>
  <p>See the latest projects we are working on</p>
</header>

<div class="posts" id="postsContainer"></div>

<!-- Image Modal -->
<div class="image-modal" id="imageModal">
  <span class="close-modal" id="closeModal">&times;</span>
  <span class="nav-btn prev-btn" id="prevBtn">&#10094;</span>
  <span class="nav-btn next-btn" id="nextBtn">&#10095;</span>
  <img class="modal-content" id="modalImage">
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAqhLfmOfmP-_8DOcoEH7Ck7fMF9Id4vJ4",
  authDomain: "earn-project-5f892.firebaseapp.com",
  databaseURL: "https://earn-project-5f892-default-rtdb.firebaseio.com/",
  projectId: "earn-project-5f892",
  storageBucket: "earn-project-5f892.firebasestorage.app",
  messagingSenderId: "8457886057",
  appId: "1:8457886057:web:b5e01d0972d169f47085f8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const postsRef = ref(db, "projects"); // 🔥 শুধু projects দেখাবে

// Same JS as your posts.html
let currentPosts = [];
let currentImageIndex = 0;
function formatLikes(num){if(num>=1000){let f=(num/1000).toFixed(1);if(f.endsWith(".0"))f=f.slice(0,-2);return f+"K";}return num;}
function openImageModal(postId,img){document.getElementById("imageModal").style.display="flex";document.getElementById("modalImage").src=img;currentImageIndex=currentPosts.findIndex(p=>p.id===postId);document.body.style.overflow="hidden";}
function closeImageModal(){document.getElementById("imageModal").style.display="none";document.body.style.overflow="auto";}
function navigateImage(d){currentImageIndex+=d;if(currentImageIndex<0)currentImageIndex=currentPosts.length-1;else if(currentImageIndex>=currentPosts.length)currentImageIndex=0;document.getElementById("modalImage").src=currentPosts[currentImageIndex].image;}
document.getElementById("closeModal").addEventListener("click",closeImageModal);
document.getElementById("prevBtn").addEventListener("click",()=>navigateImage(-1));
document.getElementById("nextBtn").addEventListener("click",()=>navigateImage(1));
document.getElementById("imageModal").addEventListener("click",(e)=>{if(e.target===document.getElementById("imageModal"))closeImageModal();});
document.addEventListener("keydown",(e)=>{if(document.getElementById("imageModal").style.display==="flex"){if(e.key==="Escape")closeImageModal();else if(e.key==="ArrowLeft")navigateImage(-1);else if(e.key==="ArrowRight")navigateImage(1);}});

onValue(postsRef,(snapshot)=>{
  const container=document.getElementById("postsContainer");
  container.innerHTML="";
  const data=snapshot.val();
  if(data){
    const postsArr=Object.entries(data).map(([id,p])=>({id,...p}));
    currentPosts=postsArr;
    postsArr.sort((a,b)=>new Date(b.date)-new Date(a.date));
    postsArr.forEach(post=>{
      if(!post.likes)post.likes=0;
      if(!post.comments)post.comments=[];
      const card=document.createElement("div");
      card.className="post-card";
      card.id=`post-${post.id}`;
      card.innerHTML=`
        <div class="post-header">
          <img src="${post.authorPhoto}" alt="Author">
          <span class="author-name">${post.author}</span>
          <span class="post-date">· ${post.date}</span>
        </div>
        <div class="post-image"><img src="${post.image}" alt="Post"></div>
        <div class="post-content">
          <h2>${post.title}</h2>
          <div class="text-container"><p>${post.content}</p></div>
          <span class="read-more-btn">Read more</span>
        </div>
        <div class="post-actions">
          <div class="action-btn like-btn"><i class="fas fa-thumbs-up"></i> <span class="like-text"></span> <span class="like-count">${formatLikes(post.likes)}</span></div>
          <div class="action-btn comment-btn"><i class="fas fa-comment"></i> Comment</div>
          <div class="action-btn share-btn"><i class="fas fa-share"></i> Share</div>
        </div>
        <div class="comment-section">
          <input type="text" placeholder="Write a comment..." class="comment-input">
          <button class="send-comment-btn">Send</button>
          <div class="comment-list"></div>
        </div>`;
      container.appendChild(card);

      card.querySelector(".post-image img").addEventListener("click",()=>openImageModal(post.id,post.image));
      const txtCont=card.querySelector(".text-container");
      const readBtn=card.querySelector(".read-more-btn");
      if(card.querySelector(".text-container p").scrollHeight>txtCont.offsetHeight){readBtn.style.display="inline-block";}else{readBtn.style.display="none";}
      readBtn.addEventListener("click",()=>{txtCont.classList.toggle("expanded");readBtn.textContent=txtCont.classList.contains("expanded")?"Read less":"Read more";});
      const likeBtn=card.querySelector(".like-btn"),likeCountEl=card.querySelector(".like-count"),likeText=card.querySelector(".like-text");
      const likedPosts=JSON.parse(localStorage.getItem("likedProjects")||"{}");
      if(likedPosts[post.id]){likeText.textContent="Unlike";likeBtn.style.color="#1976d2";}else likeText.textContent="Like";
      likeBtn.addEventListener("click",()=>{if(!likedPosts[post.id]){post.likes++;update(ref(db,`projects/${post.id}`),{likes:post.likes});likeCountEl.textContent=formatLikes(post.likes);likedPosts[post.id]=true;localStorage.setItem("likedProjects",JSON.stringify(likedPosts));likeText.textContent="Unlike";likeBtn.style.color="#1976d2";}else{post.likes--;if(post.likes<0)post.likes=0;update(ref(db,`projects/${post.id}`),{likes:post.likes});likeCountEl.textContent=formatLikes(post.likes);delete likedPosts[post.id];localStorage.setItem("likedProjects",JSON.stringify(likedPosts));likeText.textContent="Like";likeBtn.style.color="#0d47a1";}});
      const cmtBtn=card.querySelector(".comment-btn"),cmtSec=card.querySelector(".comment-section");cmtBtn.addEventListener("click",()=>{cmtSec.style.display=cmtSec.style.display==="flex"?"none":"flex";});
      const cmtList=card.querySelector(".comment-list");post.comments.forEach(c=>{const d=document.createElement("div");d.className="comment-item";d.textContent=c;cmtList.appendChild(d);});
      card.querySelector(".send-comment-btn").addEventListener("click",()=>{const txt=card.querySelector(".comment-input").value.trim();if(txt){const newC=[...post.comments,txt];update(ref(db,`projects/${post.id}`),{comments:newC});const d=document.createElement("div");d.className="comment-item";d.textContent=txt;cmtList.appendChild(d);card.querySelector(".comment-input").value="";post.comments=newC;}});
      card.querySelector(".share-btn").addEventListener("click",async()=>{const url=window.location.href+`#post-${post.id}`;if(navigator.share){try{await navigator.share({title:post.title,url});}catch(e){}}else{navigator.clipboard.writeText(url);alert("Link copied!");}});
    });
  } else container.innerHTML="<p>No projects found</p>";
});
</script>
</body>
</html>